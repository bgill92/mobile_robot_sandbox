[project]
name = "mobile_robot_sandbox"
version = "0.1.0"
description = "Mobile robot sandbox for experimenting with control and perception algorithms"
authors = ["bilal.gill@picknik.ai"]
channels = ["conda-forge", "robostack-staging"]
platforms = ["linux-64"]

[tasks]
# Build the workspace with colcon (skip tests for simulation)
# Hardware packages are ignored via COLCON_IGNORE files
build = "colcon build --symlink-install --cmake-args -DBUILD_TESTING=OFF"

# Clean build artifacts
clean = "rm -rf build install log"

# Launch the robot in maze simulation
# Note: Gazebo Classic has threading issues in conda environments that cause crashes
# This is a known limitation with no complete fix yet
sim = "bash -c 'source install/setup.bash && ros2 launch mobile_robot_algorithms robot_in_maze.launch.py'"

# Source workspace for interactive use (bash)
source = "bash -c 'source install/setup.bash && exec bash'"

# Source workspace for interactive use (zsh)
source-zsh = "zsh -c 'source install/setup.zsh && exec zsh'"

[dependencies]
# ROS2 Humble - using desktop for complete installation
ros-humble-desktop = "*"

# Gazebo Classic support
ros-humble-gazebo-ros-pkgs = "*"
ros-humble-gazebo-ros2-control = "*"

# ROS2 Control packages
ros-humble-ros2-control = "*"
ros-humble-ros2-controllers = "*"
ros-humble-controller-manager = "*"
ros-humble-diff-drive-controller = "*"
ros-humble-joint-state-broadcaster = "*"

# Additional ROS2 packages
ros-humble-xacro = "*"
ros-humble-robot-state-publisher = "*"

# Build tools
colcon-common-extensions = "*"

# Development tools
clang = "*"
cmake = "*"
git = "*"
git-lfs = "*"
neovim = "*"
tmux = "*"
vim = "*"
gdb = "*"
wget = "*"
curl = "*"

# Pin TBB to older version for Gazebo compatibility
tbb = "2021.*"

# Python and scientific packages
python = "*"
pip = "*"
matplotlib = "*"
scipy = "*"

[activation.env]
ROS_DOMAIN_ID = "0"
GAZEBO_MODEL_PATH = "$GAZEBO_MODEL_PATH:${PIXI_PROJECT_ROOT}/src/mobile_robot_algorithms/models"
# Workaround for Gazebo threading issues with TBB
OMP_NUM_THREADS = "1"
OMP_WAIT_POLICY = "PASSIVE"
